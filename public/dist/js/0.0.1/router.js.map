{"version":3,"file":"router.js","sources":["../../../../node_modules/@azizka/router/index.js"],"sourcesContent":["class Router {\r\n  routes = [];\r\n  root = '/';\r\n  before;\r\n  page404;\r\n\r\n  constructor(options) {\r\n    if(options?.root) {\r\n      this.root = options.root === '/' ? '/' : '/' + this.trimSlashes(options.root) + '/';\r\n    }\r\n\r\n    if(typeof options?.before === 'function') {\r\n      this.before = options.before;\r\n    }\r\n\r\n    if(typeof options?.page404 === 'function') {\r\n      this.page404 = options.page404;\r\n    }\r\n\r\n    if(options?.routes?.length > 0) {\r\n      options.routes.forEach(route => {\r\n        this.add(route.rule, route.handler, route.options);\r\n      });\r\n    }\r\n  }\r\n\r\n  get fragment() {\r\n    let value = decodeURI(location.pathname);\r\n\r\n    if(this.root !== '/') {\r\n      value = value.replace(this.root, \"\");\r\n    }\r\n\r\n    return this.trimSlashes(value);\r\n  }\r\n\r\n  get query() {\r\n    return this.parseQuery(location.search);\r\n  }\r\n\r\n  add(rule, handler, options) {\r\n    this.routes.push({\r\n      rule: this.parseRouteRule(rule),\r\n      handler,\r\n      options\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  remove(param) {\r\n    if(typeof param === 'string') {\r\n      param = this.parseRouteRule(param);\r\n    }\r\n\r\n    this.routes.some((route, i) => {\r\n      if(route.handler === param || route.rule === param) {\r\n        this.routes.splice(i, 1);\r\n\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    });\r\n\r\n\r\n    return this;\r\n  }\r\n\r\n  async redirectTo(url, state) {\r\n    const newUrl = this.transformURL(url);    \r\n\r\n    history.replaceState(state, null, this.root + newUrl);\r\n\r\n    await this.processUri();\r\n\r\n    return this;\r\n  }\r\n\r\n  async navigateTo(url, state) {\r\n    const newUrl = this.transformURL(url);   \r\n\r\n    history.pushState(state, null, this.root + newUrl);\r\n\r\n    await this.processUri();\r\n\r\n    return this;\r\n  }\r\n\r\n  refresh() {\r\n    return this.redirectTo(this.fragment + location.search, history.state);\r\n  }\r\n\r\n  transformURL(url) {\r\n    if(typeof url !== 'string') {\r\n      return '';\r\n    }\r\n\r\n    const newUrl = url.trim();\r\n    const splits = newUrl.split('?');\r\n\r\n    let path = '';\r\n    let query = '';\r\n\r\n    if(splits.length === 1) {\r\n      path = splits[0];\r\n    } else {\r\n      path = splits[0].trim();\r\n      query = splits[1].trim();      \r\n    }    \r\n\r\n    if(!path) {\r\n      path = this.fragment;\r\n    } else {\r\n      if(this.root !== '/') {\r\n        path = path.replace(this.root, \"\");\r\n      }\r\n\r\n      path = this.trimSlashes(path);\r\n    }\r\n\r\n    if(!query) {\r\n      return path;\r\n    }\r\n\r\n    return `${path}?${query}`;\r\n  }\r\n\r\n  trimSlashes(path) {\r\n    if(typeof path !== 'string') {\r\n      return '';\r\n    }\r\n    \r\n    return path.replace(/\\/$/, '').replace(/^\\//, '');\r\n  }\r\n\r\n  parseRouteRule(route) {\r\n    if(typeof route !== \"string\") {\r\n      return route;\r\n    }\r\n\r\n    let uri = this.trimSlashes(route);\r\n\r\n    let rule = uri\r\n      .replace(/([\\\\\\/\\-\\_\\.])/g, \"\\\\$1\")\r\n      .replace(/\\{[a-zA-Z]+\\}/g, \"(:any)\")\r\n      .replace(/\\:any/g, \"[\\\\w\\\\-\\\\_\\\\.]+\")\r\n      .replace(/\\:word/g, \"[a-zA-Z]+\")\r\n      .replace(/\\:num/g, \"\\\\d+\");\r\n\r\n    return new RegExp(\"^\" + rule + \"$\", \"i\");\r\n  }\r\n\r\n  parseQuery(query) {\r\n    let data = {};\r\n\r\n    if(typeof query !== \"string\") {\r\n      return data;\r\n    }\r\n\r\n    if(query[0] === '?') {\r\n      query = query.substr(1);\r\n    }\r\n\r\n    query.split('&').forEach(row => {\r\n      let parts = row.split('=');\r\n\r\n      if(parts[0] !== '') {\r\n        if(parts[1] === undefined) {\r\n          parts[1] = true;\r\n        }\r\n\r\n        data[decodeURIComponent(parts[0])] = parts[1];\r\n      }\r\n    });\r\n\r\n    return data;\r\n  }\r\n\r\n  async findRoute() {\r\n    let fragment = this.fragment;\r\n\r\n    let found = false;\r\n\r\n    for(let route of this.routes) {\r\n      let match = fragment.match(route.rule);\r\n\r\n      if(match) {\r\n        match.shift();\r\n\r\n        let query = this.query;\r\n        let page = {\r\n          fragment,\r\n          query,\r\n          match,\r\n          options: route.options\r\n        };\r\n\r\n        let doBreak = this.before?.(page);\r\n\r\n        if(!doBreak) {\r\n          await route.handler?.(page);\r\n        }\r\n\r\n        found = true;\r\n\r\n        break;\r\n      }\r\n    }\r\n\r\n    return found;\r\n  }\r\n\r\n  async processUri() {\r\n    let fragment = this.fragment;\r\n\r\n    let found = await this.findRoute();\r\n\r\n    if(!found) {\r\n      this.page404?.(fragment);\r\n    }\r\n  }\r\n\r\n  addUriListener() {\r\n    window.onpopstate = this.processUri.bind(this);\r\n  }\r\n\r\n  removeUriListener() {\r\n    window.onpopstate = null;\r\n  }\r\n}\r\n\r\nexports.Router = Router;\r\n"],"names":[],"mappings":"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"}