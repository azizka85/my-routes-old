import{S as e}from"./globals.js";import{B as t}from"./base-layout.js";import{t as o}from"./helpers.js";import{n}from"./client-helpers.js";import{S as s,a as r,b as a}from"./scroll.js";import{M as i}from"./list.js";import{M as l}from"./ripple.js";import"./base.js";import"./dom.js";class c extends t{static layout=null;node=null;appBarElem=null;drawerElem=null;mainContentElem=null;navIcon=null;searchIcon=null;headerIconElem=null;headerIconBtn=null;list=null;searchForm=null;static get instance(){return c.layout||(c.layout=new c),c.layout}get elem(){return this.node}async init(t,o){let r=t||document.body;if(this.node=r.querySelector('[data-layout="main-layout"]')||null,this.node){this.appBarElem=this.node.querySelector(".app-bar"),this.drawerElem=this.node.querySelector(".drawer");let t=0;this.mainContentElem=this.node.querySelector(".main-content"),this.mainContentElem?.addEventListener("scroll",(()=>{const o=this.mainContentElem?.scrollTop||0;Math.abs(o-t)>e&&(t>=o?this.appBarElem?.classList.remove("app-bar--hide"):this.appBarElem?.classList.add("app-bar--hide")),o<=0?this.appBarElem?.classList.remove("app-bar--scrolled"):this.appBarElem?.classList.add("app-bar--scrolled"),this.node?.dispatchEvent(new CustomEvent(s,{detail:{currScroll:o,prevScroll:t}})),t=o}));const o=this.appBarElem?.querySelector('[data-button="navigation"]');o&&(this.navIcon=new l(o),this.navIcon.unbounded=!0,this.navIcon.listen("click",(e=>n(e,this.navIcon?.root))));const r=this.appBarElem?.querySelector('[data-button="search"]');r&&(this.searchIcon=new l(r),this.searchIcon.unbounded=!0,this.searchIcon.listen("click",(e=>n(e,this.searchIcon?.root))));const a=this.node.querySelector('[data-button="header-navigation"]');a&&(this.headerIconElem=a.querySelector(".mdc-icon-button__ripple"),this.headerIconBtn=new l(a),this.headerIconBtn.unbounded=!0,this.headerIconBtn.listen("click",(e=>n(e,this.headerIconBtn?.root))));const c=this.node.querySelector(".mdc-list");if(c&&(this.list=new i(c),this.list.listElements.forEach((e=>{e.addEventListener("mouseenter",(()=>this.drawerElem?.classList.add("drawer--hover"))),new l(e)})),this.drawerElem?.addEventListener("mouseleave",(()=>this.drawerElem?.classList.remove("drawer--hover")))),this.searchForm=this.node.querySelector("form.search"),this.searchForm){const e=this.searchForm.querySelectorAll(".mdc-icon-button");for(let t of e){new l(t).unbounded=!0}this.searchForm.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(this.searchForm);console.log("form submited",t),this.searchForm?.reset()}))}}return r}async mount(){console.log("main-layout","mounted")}async unmount(){console.log("main-layout","unmounted")}async load(e,t){const n=e.query["main-layout-navigation"];if(this.navIcon){const t=`?${o(e.query,"main-layout-navigation")}`;this.navIcon.root.setAttribute("href",t)}if(this.headerIconBtn){const t=`?${o(e.query,"main-layout-navigation")}`;this.headerIconBtn.root.setAttribute("href",t)}if(this.searchIcon){const t=`?${o(e.query,"main-layout-search")}`;this.searchIcon.root.setAttribute("href",t)}n?(this.headerIconElem&&(this.headerIconElem.innerHTML="arrow_circle_left"),this.drawerElem?.classList.add("drawer--open")):(this.headerIconElem&&(this.headerIconElem.innerHTML="arrow_circle_right"),this.drawerElem?.classList.remove("drawer--open"))}listen(e,t){this.node?.addEventListener(e,t)}doAction(e,t){switch(e){case a:this.mainContentElem?.scrollTo({top:0});break;case r:t?.noSmooth&&this.mainContentElem?.classList.add("main-content--no-smooth"),this.mainContentElem?.scrollTo({top:t?.top}),t?.noSmooth&&this.mainContentElem?.classList.remove("main-content--no-smooth")}}}export{c as MainLayout};
